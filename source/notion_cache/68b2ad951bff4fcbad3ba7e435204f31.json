{"children":[{"children":[],"uri":"https://www.notion.so/4b0353835a504b47873d2c5d567a1b46","type":"tweet","createdTime":1592913482621,"lastEditedTime":1592913480000},{"children":[],"uri":"https://www.notion.so/49bf7445a626486aa7d534d6188876ae","type":"text","createdTime":1592913480000,"lastEditedTime":1592913480000,"title":[]},{"children":[],"uri":"https://www.notion.so/110c419e002548e1b1976271fd7b4488","type":"heading","createdTime":1592913500663,"lastEditedTime":1592913480000,"title":[["How it works"]],"depth":2},{"children":[],"uri":"https://www.notion.so/d3f58399cdc54f6293c0d33fdb60f8ba","type":"image","createdTime":1592913506196,"lastEditedTime":1592913540000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fea1d4cd1-8f16-4c4f-80c5-53243dcbf8b4%2F1_e6uPKHACWbRzuaci0bxpXQ.gif?width=626","caption":[],"width":626,"height":363,"fullWidth":false,"pageWidth":false,"aspectRatio":0.5798722044728435,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/41a22901bc1c46c4a266fe6e9bc38d34","type":"text","createdTime":1592913480000,"lastEditedTime":1592913480000,"title":[]},{"children":[],"uri":"https://www.notion.so/056bde50b0b64a44abfd11d921faef45","type":"text","createdTime":1592913480000,"lastEditedTime":1592913480000,"title":[]},{"children":[],"uri":"https://www.notion.so/03f50b8d8d76461da5d34272cd0b0fcc","type":"text","createdTime":1592913520598,"lastEditedTime":1592913480000,"title":[["The web app deployed at¬†"],["0x.now.sh",[["a","https://0x.now.sh/"]]],[", interacts with a smart contract deployed on¬†"],["Ethereum Ropsten testnet",[["a","https://ropsten.etherscan.io/address/0x4b8241f24537d2539d0b310bc074fd68a782e182"]]],[". Being on testnet means you can interact with it using free ethers. Get your¬†"],["free ethers here",[["a","https://faucet.metamask.io/"]]],["."]]},{"children":[],"uri":"https://www.notion.so/73cdd275d9f54d129ea6e5fee8839b13","type":"heading","createdTime":1592913520598,"lastEditedTime":1592913480000,"title":[["The Process",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/57008740f584407c984ff70a1b63f6d9","type":"bulleted_list","createdTime":1592913520599,"lastEditedTime":1592913480000,"title":[["Users make a transaction requesting the blockchain to store a URL string."]]},{"children":[],"uri":"https://www.notion.so/af77f4ab53a142abb32a0ca294ede0f6","type":"bulleted_list","createdTime":1592913520599,"lastEditedTime":1592913480000,"title":[["Since it is a transaction that modifies the state of the blockchain, it needs to have some amount of ethers attached to it so that it can be mined to the blockchain by miners."]]},{"children":[],"uri":"https://www.notion.so/996ffbb85aaf4f9992dab56e593ebd2f","type":"bulleted_list","createdTime":1592913520599,"lastEditedTime":1592913480000,"title":[["The amount of fee (also called¬†"],["gas",[["a","https://www.cryptocompare.com/coins/guides/what-is-the-gas-in-ethereum/"]]],[") is determined by the Metamask chrome extension and displayed in the prompt box."]]},{"children":[],"uri":"https://www.notion.so/9a58fa4430884a109bf6d8b916ebef34","type":"bulleted_list","createdTime":1592913520599,"lastEditedTime":1592913480000,"title":[["There is some waiting time for the transaction to be confirmed (5‚Äì10sec) depending on how busy the blockchain is."]]},{"children":[],"uri":"https://www.notion.so/9e36c19ec9cd423e9346e6f146dff2ff","type":"bulleted_list","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["The shortened URL is generated. eg¬†"],["https://0x.now.sh/s?id=23",[["a","https://0x.now.sh/s?id=23"]]]]},{"children":[],"uri":"https://www.notion.so/da838719c4364002bdaf2f8a85eefabe","type":"bulleted_list","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["When the users clicks on the shortened URL another transaction is made requesting the blockchain which URL string is located at the provided reference (in this case 23)"]]},{"children":[],"uri":"https://www.notion.so/b7d31ace2244437ea2bfce91887fe93a","type":"bulleted_list","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["Since this transaction is not changing the state of the blockchain, we do not need to pay any ETH this time, the user is seamlessly redirected to the long URL."]]},{"children":[],"uri":"https://www.notion.so/d06637f1479246afb440dc4bc1cd12f6","type":"heading","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["dApp",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/4e5b7f4b6478402bb7c01f355ac076d1","type":"text","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["Being a Decentralized application means that this web app does not require any centralized database to function. It only interacts with the smart contract deployed on the blockchain."]]},{"children":[],"uri":"https://www.notion.so/aa727e0d1a504d6f8d11934c51eef4f4","type":"heading","createdTime":1592913520600,"lastEditedTime":1592913480000,"title":[["The SmartContract üìÉ",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/a7ece85ae85545daad33ed2a82bbf7a4","type":"code","createdTime":1592913531621,"lastEditedTime":1592913480000,"title":[["pragma solidity ^0.4.24;\ncontract e0x {\n event Log(string message);\n event LinkAdded(uint linkId, string url);\n \n struct LinkTemplate {\n  address userAddress;\n  string url;\n }\n \n uint lastLinkId;\n mapping (uint => LinkTemplate) public linkMapping;\n \n constructor() public {\n  lastLinkId = 0;\n }\n \n \n function createNewLink(string url) public returns (uint) {\n     lastLinkId++;\n  linkMapping[lastLinkId] = LinkTemplate(msg.sender, url);\n  emit LinkAdded(lastLinkId, url);\n  return lastLinkId;\n }\n \n modifier linkExists(uint linkId) {\n     //link with the given hash does not exist\n  if(linkMapping[linkId].userAddress == 0x0000000000000000000000000000000000000000) {\n   revert();\n  }\n  _;\n }\n \n function getLink(uint linkId) linkExists(linkId) public constant\n  returns(\n   address,\n   string\n  ) {\n      LinkTemplate memory link = linkMapping[linkId];\n   return(\n    link.userAddress,\n       link.url\n   );\n  }\n}"]],"language":"JavaScript","wrap":false},{"children":[],"uri":"https://www.notion.so/622c57a1c3cb4ce8b2caab9141735e58","type":"text","createdTime":1592913480000,"lastEditedTime":1592913480000,"title":[]},{"children":[],"uri":"https://www.notion.so/1cdedff1dbd348a9882ffae2bbbc5963","type":"text","createdTime":1592913480000,"lastEditedTime":1592913480000,"title":[]},{"children":[],"uri":"https://www.notion.so/10cb260cbe804422b60029853fdd39ee","type":"heading","createdTime":1592913548326,"lastEditedTime":1592913540000,"title":[["Technical Challenges",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/93ae24d314fb499eae2e1a569d9cd0b7","type":"heading","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["Interacting with the smart contract",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/0e2164902ef44c84b465095a45062d22","type":"text","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["EthersJS library is used to talk to the blockchain"]]},{"children":[],"uri":"https://www.notion.so/f96cf17acc4246118b410611960efdc9","type":"code","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["// provider picks up the Metamask injected web3 object from browser \nlet provider = new ethers.providers.Web3Provider(web3.currentProvider);\nlet address = \"ADDRESS_OF_DEPLOYED_SMART_CONTRACT\";\nlet abi = [...] //defines JSON interface for the smart contract"]],"language":"Plain Text","wrap":false},{"children":[],"uri":"https://www.notion.so/fb8a345cb9524ac0953ab492c4df250e","type":"heading","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["Storing data on the blockchain",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/9f0f98fef7784ba9a8ece354a8169e28","type":"code","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["// calling the createNewLink function defined in the smart contract\ntx = await contract.createNewLink(url);\nconsole.log(tx.hash);"]],"language":"Plain Text","wrap":false},{"children":[],"uri":"https://www.notion.so/a5d28761a7954d7f8be3543ba41d1480","type":"heading","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["Listening to blockchain events",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/6d6aff64191c4247b92ffb7e0aff4872","type":"code","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["contract.on(\"LinkAdded\", (linkId, linkUrl) => {\n        \n        var shortUrl = '{0}/s?id={1}'.f(window.location.origin, linkId.toNumber())\n        $(\"#info\").prepend( \"Short URL: <a href='{0}'>{0}</a><br>\".f(shortUrl) );\n        \n    });"]],"language":"Plain Text","wrap":false},{"children":[],"uri":"https://www.notion.so/b4185762c5d04c80a835dd6495253c68","type":"heading","createdTime":1592913548327,"lastEditedTime":1592913540000,"title":[["Generating the list of recently shortened URLs",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/c26b977a42264a6f8a5f97013f4394d0","type":"text","createdTime":1592913540000,"lastEditedTime":1592913540000,"title":[]},{"children":[],"uri":"https://www.notion.so/ced871144f8c497c99c2669ec25edcc6","type":"text","createdTime":1592913566722,"lastEditedTime":1592913540000,"title":[["EthersJS doe not support batch listening of events so I had to use web3js‚Äôs allEvents() function call"]]},{"children":[],"uri":"https://www.notion.so/5f7656d1b8b4419e9a56bc7ba4301174","type":"code","createdTime":1592913566722,"lastEditedTime":1592913540000,"title":[["MyContract = web3.eth.contract(abi);\n    myContractInstance = MyContract.at(address);\n    events = myContractInstance.allEvents({event: 'LinkAdded', fromBlock: 0, toBlock: 'latest'});\n    events.watch(function(error, result){\n      console.log(result.args.url, result.args.linkId.toNumber());\n      ...\n});"]],"language":"Plain Text","wrap":false},{"children":[],"uri":"https://www.notion.so/117f90ba771747b08d316d13b93fd192","type":"heading","createdTime":1592913566722,"lastEditedTime":1592913540000,"title":[["Making the shortened URLs accessible in all Browsers",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/b2cdc04f59fa4043a5522653273717a2","type":"text","createdTime":1592913540000,"lastEditedTime":1592913540000,"title":[]},{"children":[],"uri":"https://www.notion.so/654f49c1b6aa4cc188b5180d42e7fd55","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["This was quite tricky because interacting with blockchain required the browser to be web3 enabled, and have some wallet installed (metamask or similar). Currently web3 and wallet support is only for Chrome and Firefox on Desktop only."]]},{"children":[],"uri":"https://www.notion.so/d007804e8f44464ab25ee7adeefafcce","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["To solve this, I had to create a wallet on the fly as follows"]]},{"children":[],"uri":"https://www.notion.so/f3dd0f87609b4d749e94b3812c254eae","type":"code","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["provider = ethers.getDefaultProvider('ropsten');\nwallet = ethers.Wallet.createRandom();\nwallet = wallet.connect(provider);"]],"language":"Plain Text","wrap":false},{"children":[],"uri":"https://www.notion.so/1803582c03184034a891d95c4ee477ab","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["Shout out to the awesome¬†"],["ethersJS library",[["a","https://github.com/ethers-io/ethers.js/"]]],["¬†for having support for this."]]},{"children":[],"uri":"https://www.notion.so/bb1a4842d99c4409897627c9459eaea0","type":"heading","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["Counting URL visits",[["b",null]]]],"depth":1},{"children":[],"uri":"https://www.notion.so/a4de286ddf1c4ae4a7ff705fc1a7219c","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["The flexibility for using this one all browsers comes at a cost. Each time user clicks on the shortened URL no change is made to the blockchain state, hence it is not possible to determine how many times each link was clicked. This issues remains unsolved."]]},{"children":[],"uri":"https://www.notion.so/d1d9f41aaf6f48ee8cbee34843ef097b","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["The complete source code for this project is on¬†"],["Github",[["a","https://github.com/sauravtom/ethereum-url-shortener"]]],["."]]},{"children":[],"uri":"https://www.notion.so/87a8192dc0964d46a5b7ef8eb6a09ea2","type":"text","createdTime":1592913580314,"lastEditedTime":1592913540000,"title":[["Pull Requests welcome üòÅ"]]},{"children":[],"uri":"https://www.notion.so/bf12b1a9e97d49a5a78bd69badfd20dd","type":"text","createdTime":1592913540000,"lastEditedTime":1592913540000,"title":[]}],"uri":"https://www.notion.so/68b2ad951bff4fcbad3ba7e435204f31","type":"page","createdTime":1592913420000,"lastEditedTime":1603287960000,"title":[["Making a URL shortener on Ethereum"]],"fullWidth":false,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"'2]%":[["ethereum-url-shortener"]],":H`m":[["Yes"]],"xY$N":[["‚Ä£",[["d",{"type":"date","start_date":"2018-12-02"}]]]],"{iD?":[["hack,ethereum,blockchain"]],"|Ay0":[["post"]],"title":[["Making a URL shortener on Ethereum"]]}}